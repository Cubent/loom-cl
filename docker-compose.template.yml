name: cap-so-docker-template

# THIS IS A TEMPLATE FOR DOCKER COMPOSE FILES
# IT IS NOT MEANT FOR PRODUCTION DEPLOYMENT WITHOUT MODIFICATIONS TO ENVIRONMENT VARIABLES
# IT IS MEANT FOR LOCAL EVALUATION AND DEVELOPMENT PURPOSES ONLY

services:
  cap-web:
    container_name: cap-web
    image: ghcr.io/capsoftware/cap-web:latest
    restart: unless-stopped
    environment:
      DATABASE_URL: 'postgresql://postgres:postgres@postgres:5432/cap'
      WEB_URL: http://localhost:3000
      NEXTAUTH_URL: http://localhost:3000
      # CHANGE THESE TO YOUR OWN VALUES
      DATABASE_ENCRYPTION_KEY: c7a1e98e1e5e4cec5a3fbf5eaf502d262fb99807ae2be8ee70537409e29cb6f9
      NEXTAUTH_SECRET: c7a1e98e1e5e4cec5a3fbf5eaf502d262fb99807ae2be8ee70537409e29cb6f9
      # CHANGE THESE TO MATCH YOUR MINIO or S3 STORAGE SETUP
      CAP_AWS_ACCESS_KEY: capS3root
      CAP_AWS_SECRET_KEY: capS3root
      CAP_AWS_BUCKET: capso
      CAP_AWS_REGION: us-east-1
      S3_PUBLIC_ENDPOINT: http://localhost:3902
      S3_INTERNAL_ENDPOINT: http://minio:3902
    ports:
      - 3000:3000

  postgres:
    container_name: cap-primary-db
    image: postgres:16-alpine
    restart: unless-stopped
    environment:
      # CHANGE THESE TO YOUR OWN VALUES - BE SURE TO SET A PASSWORD
      POSTGRES_DB: cap
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data

  # Local S3 Strorage
  minio:
    container_name: cap-minio-storage
    image: "bitnami/minio:latest"
    restart: unless-stopped
    ports:
      - "3902:3902"
      - "3903:3903"
    environment:
      - MINIO_API_PORT_NUMBER=3902
      - MINIO_CONSOLE_PORT_NUMBER=3903
      # CHANGE THESE TO YOUR OWN VALUES
      - MINIO_ROOT_USER=capS3root
      - MINIO_ROOT_PASSWORD=capS3root
    volumes:
      - minio-data:/bitnami/minio/data
      - minio-certs:/certs
volumes:
  postgres-data:
  # REMOVE THESE IF YOU ARE NOT USING MINIO VIA THIS DOCKER COMPOSE FILE
  minio-data:
  minio-certs:
